

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Official Builds &mdash; AVE User&#39;s Guide  documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="AVE User&#39;s Guide  documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">AVE User&#39;s Guide  documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="official-builds">
<h1>Official Builds<a class="headerlink" href="#official-builds" title="Permalink to this headline">¶</a></h1>
<div class="section" id="label-builds">
<h2>Label Builds<a class="headerlink" href="#label-builds" title="Permalink to this headline">¶</a></h2>
<p>Official builds must be configured to use the function that builds both e.g.
the <tt class="docutils literal"><span class="pre">userdebug</span></tt> variant of each component and the extra content that is used
during testing. I.e. the build job should produce a Debian package for the
component itself <em>and</em> a Debian package for any extra test content.</p>
<p>There are three passes in the build job that produce artifacts that must be
packaged this way:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">Android.mk</span></tt> based components in the platform.</li>
<li><tt class="docutils literal"><span class="pre">semc-build</span></tt> based components (platform and/or apps).</li>
<li><tt class="docutils literal"><span class="pre">semc-build</span></tt> based decoupled applications.</li>
</ul>
</div></blockquote>
<p>To test that the build job is set up correctly, run the following test for each
kind of component:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/python2</span>

<span class="kn">from</span> <span class="nn">ave.workspace</span> <span class="kn">import</span> <span class="n">Workspace</span>
<span class="kn">from</span> <span class="nn">ave.label</span>     <span class="kn">import</span> <span class="n">get_latest</span>

<span class="c"># set these to appropriate values</span>
<span class="n">branch</span>  <span class="o">=</span> <span class="s">&#39;THE BRANCH TO BE TESTED&#39;</span>
<span class="n">package</span> <span class="o">=</span> <span class="s">&#39;THE NAME OF THE PACKAGE WITH TEST CONTENT&#39;</span>
<span class="n">pc</span>      <span class="o">=</span> <span class="s">&#39;testcontent&#39;</span> <span class="c"># None for regular packages</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">get_latest</span><span class="p">(</span><span class="n">branch</span><span class="p">)</span>
    <span class="n">path</span>  <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">download_c2d</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">pc</span><span class="o">=</span><span class="n">pc</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;FAIL: could not download package: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">unpack_c2d</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;FAIL: could not unpack package: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="c"># check that contents in the returned path matches what is expected for the</span>
<span class="c"># package that was downloaded.</span>

<span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
</div>
<div class="section" id="commit-builds">
<h2>Commit Builds<a class="headerlink" href="#commit-builds" title="Permalink to this headline">¶</a></h2>
<p>This works like the label build jobs, but the test selects the content directly
from Jenkins. The build steps to secure are the same (platform, coupled and
decoupled components) but the test is a little bit different:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/python2</span>

<span class="kn">from</span> <span class="nn">ave.workspace</span> <span class="kn">import</span> <span class="n">Workspace</span>

<span class="c"># set these to appropriate values</span>
<span class="n">job</span>       <span class="o">=</span> <span class="s">&#39;THE ID OF THE OFFICIAL JENKINS BUILD JOB&#39;</span>
<span class="n">artifacts</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;artifact1&#39;</span><span class="p">,</span> <span class="s">&#39;artifact2&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="c"># as found in jenkins</span>
<span class="n">host</span>      <span class="o">=</span> <span class="bp">None</span> <span class="c"># defaults to &#39;http://android-ci.sonyericsson.net&#39;</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">download_jenkins</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">artifacts</span><span class="o">=</span><span class="n">artifacts</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">host</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;FAIL: could not download artifacts: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="c"># check that contents in the returned path matches the expected artifacts</span>

<span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Official Builds</a><ul>
<li><a class="reference internal" href="#label-builds">Label Builds</a></li>
<li><a class="reference internal" href="#commit-builds">Commit Builds</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/governance/bringup_official_build.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">AVE User&#39;s Guide  documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2014, Sony Mobile Communications Inc..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>