

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ADB Server &mdash; AVE User&#39;s Guide  documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="AVE User&#39;s Guide  documentation" href="../../index.html" />
    <link rel="up" title="Handset" href="index.html" />
    <link rel="next" title="Relay" href="../../relay/docs/api.html" />
    <link rel="prev" title="Android Handset" href="android_api.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../relay/docs/api.html" title="Relay"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="android_api.html" title="Android Handset"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">AVE User&#39;s Guide  documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Handset</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="adb-server">
<h1>ADB Server<a class="headerlink" href="#adb-server" title="Permalink to this headline">¶</a></h1>
<p>This package contains functionality to track the liveness of the ADB server on
the PC and starts a new one as needed. It also tries to kill any competing ADB
server to make sure it stays in control.</p>
<p>That probably sounds nuts. Well behaved programs should not go around killing
each other, right? Unfortunately...</p>
<ul class="simple">
<li>The ADB server is unstable, so its liveness needs tracking.</li>
<li>There is a bug in the ADB server&#8217;s daemonization code which prevents it from
actually daemonizing under some conditions. When this happens, every client
command causes a new ADB server to start and then immediately die when the
result has been returned to the client. The unwanted server death causes all
ADB connections to all handsets to be closed.</li>
<li>Any client can intentionally kill the ADB server unless it was started as
root, triggering the rolling error condition described above.</li>
</ul>
<p>As it is, the &#8220;only&#8221; way to handle the worst effects is to start the ADB server
as <tt class="docutils literal"><span class="pre">root</span></tt> from <tt class="docutils literal"><span class="pre">init</span></tt> and then watch that server process closely. The exact
behavior can be controlled with a configuration file.</p>
<dl class="class">
<dt id="ave.adb.server.AdbServer">
<em class="property">class </em><tt class="descclassname">ave.adb.server.</tt><tt class="descname">AdbServer</tt><big>(</big><em>home=None</em>, <em>config=None</em><big>)</big><a class="headerlink" href="#ave.adb.server.AdbServer" title="Permalink to this definition">¶</a></dt>
<dd><p>If no parameters are passed, the <tt class="docutils literal"><span class="pre">AdbServer</span></tt> class&#8217; configuration is
loaded from <tt class="docutils literal"><span class="pre">&lt;home&gt;/.ave/config/adb_server.json</span></tt> where <tt class="docutils literal"><span class="pre">&lt;home&gt;</span></tt> is the
value of <tt class="docutils literal"><span class="pre">&quot;home&quot;</span></tt> in <tt class="docutils literal"><span class="pre">/etc/ave/user</span></tt>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>home</strong> &#8211; Use an alternative value of <tt class="docutils literal"><span class="pre">&lt;home&gt;</span></tt>.</li>
<li><strong>config</strong> &#8211; Use an explicit set of configuration values (a dictionary). If
this is passed, the default configuration file will not be loaded.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="classmethod">
<dt id="ave.adb.server.AdbServer.find_server_processes">
<em class="property">classmethod </em><tt class="descname">find_server_processes</tt><big>(</big><em>port=None</em><big>)</big><a class="headerlink" href="#ave.adb.server.AdbServer.find_server_processes" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of PID&#8217;s with server processes that listen to a selected
TCP port <em>port</em>, or any server if <em>port</em> is omitted.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>port</strong> &#8211; An integer or <tt class="docutils literal"><span class="pre">None</span></tt>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A list of integers (PIDs).</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="ave.adb.server.AdbServer.kill_all_servers">
<em class="property">classmethod </em><tt class="descname">kill_all_servers</tt><big>(</big><em>port=None</em>, <em>excepted=None</em><big>)</big><a class="headerlink" href="#ave.adb.server.AdbServer.kill_all_servers" title="Permalink to this definition">¶</a></dt>
<dd><p>Kill all ADB servers that listen to the TCP port <em>port</em> and do not have
the same PID as <em>excepted</em>. Kill all ADB servers if both parameters are
omitted.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>port</strong> &#8211; Integer. Only kill servers that listen to this TCP port.</li>
<li><strong>excepted</strong> &#8211; Integer. Do not kill a server with this PID.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="ave.adb.server.AdbServer.load_config">
<em class="property">classmethod </em><tt class="descname">load_config</tt><big>(</big><em>home</em><big>)</big><a class="headerlink" href="#ave.adb.server.AdbServer.load_config" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the file <tt class="docutils literal"><span class="pre">&lt;home&gt;/.ave/config/adb_server.json</span></tt> and validate its
contents.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>home</strong> &#8211; String. A valid directory path.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ave.adb.server.AdbServer.kill_competition">
<tt class="descname">kill_competition</tt><big>(</big><big>)</big><a class="headerlink" href="#ave.adb.server.AdbServer.kill_competition" title="Permalink to this definition">¶</a></dt>
<dd><p>Kill all ADB servers that were not created by the current instance of
the <tt class="docutils literal"><span class="pre">AdbServer</span></tt> class.</p>
</dd></dl>

<dl class="method">
<dt id="ave.adb.server.AdbServer.start_server">
<tt class="descname">start_server</tt><big>(</big><big>)</big><a class="headerlink" href="#ave.adb.server.AdbServer.start_server" title="Permalink to this definition">¶</a></dt>
<dd><p>Start a new ADB server. The call returns immediately.</p>
</dd></dl>

<dl class="method">
<dt id="ave.adb.server.AdbServer.stop_server">
<tt class="descname">stop_server</tt><big>(</big><big>)</big><a class="headerlink" href="#ave.adb.server.AdbServer.stop_server" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop an ADB server that were previously started with <tt class="docutils literal"><span class="pre">start_server()</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="ave.adb.server.AdbServer.run">
<tt class="descname">run</tt><big>(</big><big>)</big><a class="headerlink" href="#ave.adb.server.AdbServer.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Kill all other ADB servers, then start a new one and wait until it dies.
Repeat forever if this <tt class="docutils literal"><span class="pre">AdbServer</span></tt> instance was configured to be
persistent (see <em>Configuration Files</em> below).</p>
</dd></dl>

</dd></dl>

<div class="section" id="command-line-interface">
<h2>Command Line Interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h2>
<p>A tool called <tt class="docutils literal"><span class="pre">ave-adb-server</span></tt> wraps the functionality desribed above:</p>
<div class="highlight-python"><pre>ave-adb-server --start   # start a new instance
               --restart # replace a running instance with a new one
               --stop    # stop a running instance</pre>
</div>
</div>
<div class="section" id="configuration-files">
<span id="adb-server-config"></span><h2>Configuration Files<a class="headerlink" href="#configuration-files" title="Permalink to this headline">¶</a></h2>
<div class="section" id="ave-config-adb-server-json">
<h3><tt class="docutils literal"><span class="pre">.ave/config/adb_server.json</span></tt><a class="headerlink" href="#ave-config-adb-server-json" title="Permalink to this headline">¶</a></h3>
<p>If this file exists, it must contain a dictionary. The dictionary may have any
of the following fields:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">port</span></tt>: The port number the ADB server should be listening on.</li>
<li><tt class="docutils literal"><span class="pre">persist</span></tt>: A boolean. If <tt class="docutils literal"><span class="pre">True</span></tt>, a new ADB server is started if the
currently executing one exits.</li>
<li><tt class="docutils literal"><span class="pre">demote</span></tt>: A boolean. If <tt class="docutils literal"><span class="pre">True</span></tt>, the tool <tt class="docutils literal"><span class="pre">ave-adb-server</span></tt> tries to
demote its own effective user ID to the configured AVE user (see the
value of <tt class="docutils literal"><span class="pre">name</span></tt> in <tt class="docutils literal"><span class="pre">/etc/ave/user</span></tt>). This only works if the tool
was executed with sufficient privileges (i.e. as root).</li>
</ul>
<p>This is the default configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s">&quot;port&quot;</span><span class="p">:</span> <span class="mi">5037</span><span class="p">,</span>
    <span class="s">&quot;persist&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s">&quot;demote&quot;</span><span class="p">:</span> <span class="n">false</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">ADB Server</a><ul>
<li><a class="reference internal" href="#command-line-interface">Command Line Interface</a></li>
<li><a class="reference internal" href="#configuration-files">Configuration Files</a><ul>
<li><a class="reference internal" href="#ave-config-adb-server-json"><tt class="docutils literal"><span class="pre">.ave/config/adb_server.json</span></tt></a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="android_api.html"
                        title="previous chapter">Android Handset</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../../relay/docs/api.html"
                        title="next chapter">Relay</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/handset/docs/adb_server_api.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../relay/docs/api.html" title="Relay"
             >next</a> |</li>
        <li class="right" >
          <a href="android_api.html" title="Android Handset"
             >previous</a> |</li>
        <li><a href="../../index.html">AVE User&#39;s Guide  documentation</a> &raquo;</li>
          <li><a href="index.html" >Handset</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2014, Sony Mobile Communications Inc..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>