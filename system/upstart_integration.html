

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Upstart Integration &mdash; AVE User&#39;s Guide  documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="AVE User&#39;s Guide  documentation" href="../index.html" />
    <link rel="up" title="System Documentation" href="index.html" />
    <link rel="next" title="Services" href="services.html" />
    <link rel="prev" title="Relay Server" href="../relay/docs/system.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="services.html" title="Services"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../relay/docs/system.html" title="Relay Server"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">AVE User&#39;s Guide  documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">System Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="upstart-integration">
<h1>Upstart Integration<a class="headerlink" href="#upstart-integration" title="Permalink to this headline">¶</a></h1>
<p><em>Upstart</em> is the current <tt class="docutils literal"><span class="pre">init</span></tt> implementation in Ubuntu. It is slated for
migration to <em>systemd</em> sometime in the future as Debian has recently opted to
make it the default <tt class="docutils literal"><span class="pre">init</span></tt> implementation on Linux. <em>Upstart</em> is used by AVE
to start various services, such as the broker, when the PC boots.</p>
<p>The current volatile situation with <tt class="docutils literal"><span class="pre">init</span></tt> implementations on Linux prompted
a solution that does not actually make any use of &#8220;extra&#8221; features found in
<em>Upstart</em>, compared to the classic <em>SysV</em> implementation. Such use would make
future migration to another implementation difficult. <em>Upstart</em> is only used to
<em>start</em> AVE services at boot. The lab owner must interact directly with the
various services to start, restart and stop them after the PC is fully booted.</p>
<div class="section" id="model">
<h2>Model<a class="headerlink" href="#model" title="Permalink to this headline">¶</a></h2>
<p>All AVE services must implement this command line interface:</p>
<div class="highlight-python"><pre>ave-&lt;service&gt; --start --force</pre>
</div>
<p>which will be used from a corresponding <em>Upstart</em> rule in:</p>
<div class="highlight-python"><pre>/etc/init/ave-&lt;service&gt;.conf</pre>
</div>
<p>The CLI arguments must be handled like so:</p>
<blockquote>
<div><ul class="simple">
<li>Delete any existing PID file found in <tt class="docutils literal"><span class="pre">/var/tmp/ave-&lt;service&gt;.pid</span></tt>.</li>
<li>Start the service daemonized.</li>
<li>Create <tt class="docutils literal"><span class="pre">/var/tmp/ave-&lt;service&gt;.pid</span></tt>.</li>
</ul>
</div></blockquote>
<p>The <em>Upstart</em> configuration file should normally not start the service until
the local file system and full networking is available. AVE services demote
their effective user ID to whatever is found in <tt class="docutils literal"><span class="pre">/etc/ave/user</span></tt>, so the file
system and networking are needed to interact with the networked authentication
system used at SoMC. <em>Broker</em> example:</p>
<div class="highlight-python"><pre># /etc/init/ave-broker.conf
description "ave-broker"

start on (filesystem and net-device-up IFACE!=lo)

console output
expect daemon

exec /usr/bin/ave-broker --start --force</pre>
</div>
</div>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul>
<li><p class="first">The lab owner can disable automatic start of a service at boot by commenting
out the <tt class="docutils literal"><span class="pre">exec</span></tt> line in the corresponding <tt class="docutils literal"><span class="pre">/etc/init/ave-&lt;service&gt;.conf</span></tt>
file.</p>
</li>
<li><p class="first">The default <em>Upstart</em> file for <em>Flocker</em> has the <tt class="docutils literal"><span class="pre">exec</span></tt> commented out. Most
hosts should not run this service. (Note that Flocker&#8217;s configuration file
<tt class="docutils literal"><span class="pre">.ave/config/flocker.json</span></tt> is also not created by default for the same
reason, and because its contents depends very much on the local configuration
of <em>lighttpd</em>, which AVE does not try to parse.)</p>
</li>
<li><p class="first">The service that starts the ADB server runs as root. (This is needed to
guarantee that ADB will have sufficient permissions to claim the equipment
on USB level. It also makes ADB a bit more reliable in general.) Users who
want to control the life cycle of the ADB server manually should create
<tt class="docutils literal"><span class="pre">.ave/config/adb_server.json</span></tt> with this content:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span> <span class="s">&quot;demote&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span> <span class="s">&quot;persist&quot;</span><span class="p">:</span><span class="n">false</span> <span class="p">}</span>
</pre></div>
</div>
<p>This still starts the ADB server on PC boot, but not as <tt class="docutils literal"><span class="pre">root</span></tt> and the ADB
server will not be restarted automatically when it is killed.</p>
</li>
</ul>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Upstart Integration</a><ul>
<li><a class="reference internal" href="#model">Model</a></li>
<li><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../relay/docs/system.html"
                        title="previous chapter">Relay Server</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="services.html"
                        title="next chapter">Services</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/system/upstart_integration.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="services.html" title="Services"
             >next</a> |</li>
        <li class="right" >
          <a href="../relay/docs/system.html" title="Relay Server"
             >previous</a> |</li>
        <li><a href="../index.html">AVE User&#39;s Guide  documentation</a> &raquo;</li>
          <li><a href="index.html" >System Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2014, Sony Mobile Communications Inc..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>