

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Verifying Customized Products &mdash; AVE User&#39;s Guide  documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="AVE User&#39;s Guide  documentation" href="../index.html" />
    <link rel="up" title="Frequently Asked Questions" href="index.html" />
    <link rel="next" title="Scheduling" href="schedulers.html" />
    <link rel="prev" title="Create Code Coverage Report" href="code_coverage.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="schedulers.html" title="Scheduling"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="code_coverage.html" title="Create Code Coverage Report"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">AVE User&#39;s Guide  documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Frequently Asked Questions</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="verifying-customized-products">
<h1>Verifying Customized Products<a class="headerlink" href="#verifying-customized-products" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This material is not finished and is likely to change. A pilot
study is currently evaluating the best way to handle product composition
labels.</p>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This document describes how to verify customized products with DUST compliant
AVE jobs. It does <cite>not</cite> describe how to test customized products by breaking
out of AVE&#8217;s golden cage model (i.e. by using untraceable content, such as
locally produced flashable images).</p>
<p class="rubric">Terminology</p>
<ul class="simple">
<li><strong>PCL</strong>: <em>Product Composition Label</em>. A C2D label that combines a system
label with a CDF to produce a fully customized product.</li>
<li><strong>CDF</strong>: <em>Customization Data File</em>. Technically a Debian package containing
additions, removals and replacements of content found in generic PPs. In CM
terms it is the toplevel configuration item that defines a product.</li>
<li><strong>PP</strong>: <em>Product Package</em>. A generic product definition, produced by an
official system build.</li>
</ul>
</div>
<div class="section" id="premises">
<h2>Premises<a class="headerlink" href="#premises" title="Permalink to this headline">¶</a></h2>
<p>To be DUST compliant, an AVE job must only use &#8220;blessed&#8221; content sources: Git,
C2D or commit triggered official builds (Jenkins). This makes it impossible to
work with custom products because the product configurations (CDFs) are by
default not stored in C2D.</p>
<img alt="../_images/cdf-problem.jpg" src="../_images/cdf-problem.jpg" />
<p>However, the CDFs are designed to be used with the same composition tools
as the generic products. That means they are also designed for storage in C2D.
All that is missing is to store the CDFs in C2D and set labels on combinations
of CDFs and system builds.</p>
<img alt="../_images/cdf-solution.jpg" src="../_images/cdf-solution.jpg" />
<p>This setup is currently evaluated in a pilot study. <em>The mechanism cannot
currently be offered to any and all users who wish to use it.</em> Instead, users
should contact the <a class="reference external" href="mailto:DL-WW-AVE-GB&#37;&#52;&#48;sonymobile&#46;com">AVE goveranance board</a> to
discuss needs for specific PCLs.</p>
</div>
<div class="section" id="product-composition-label">
<h2>Product Composition Label<a class="headerlink" href="#product-composition-label" title="Permalink to this headline">¶</a></h2>
<p>A PCL is produced by removing redundant PPs and <tt class="docutils literal"><span class="pre">mw-system</span></tt> packages from a
system label. The CDF is then added. The result can be used as input to
<tt class="docutils literal"><span class="pre">semcpkgtoimg</span></tt>. Example:</p>
<div class="highlight-python"><pre>semcpkgtoimg \
     cdf-honami-1276-4318-customized-ce1-ce1 \
     variant-userdebug \
     result-flashable \
     --label=cdf.1276.4318.R3C.sys.14.3.A.1.295</pre>
</div>
<p>The first parameter is the Debian package name of the CDF. The last parameter
is the PCL.</p>
<p>A PCL is currently not added to any CM branch and will not appear in the output
from e.g. <tt class="docutils literal"><span class="pre">repository</span> <span class="pre">latestlabel</span> <span class="pre">&lt;branch&gt;</span></tt>.</p>
</div>
<div class="section" id="pcl-and-dust">
<h2>PCL and DUST<a class="headerlink" href="#pcl-and-dust" title="Permalink to this headline">¶</a></h2>
<p>Information on how to run PCL&#8217;s through DUST are found <a class="reference external" href="https://wiki.sonyericsson.net/androiki/Dust_PCL">here</a>.</p>
</div>
<div class="section" id="creation-of-pcls">
<h2>Creation of PCLs<a class="headerlink" href="#creation-of-pcls" title="Permalink to this headline">¶</a></h2>
<p>A specially crafted tool is used to create PCLs. It is available at</p>
<blockquote>
<div><em>git://withheld-during-pilot-study</em></div></blockquote>
<p>How to install:</p>
<ul class="simple">
<li>Download the git tree</li>
<li>Install AVE. The tool uses API&#8217;s from the <em>ave-workspace</em> package to interact
with C2D.</li>
</ul>
<p>How to run:</p>
<div class="highlight-python"><pre>cd &lt;git tree&gt;
PYTHONPATH=src bin/c2d-cdf-label --system=&lt;system label&gt; --cdf=&lt;http url&gt;</pre>
</div>
<p>Steps performed by the tool:</p>
<ul class="simple">
<li>Download the CDF zip file from CDA-Front (the <tt class="docutils literal"><span class="pre">--cdf</span></tt> parameter).</li>
<li>Unpack the zip file to find the CDF Debian package.</li>
<li>Load the Debian package. The metadata about the package (from its Debian
<em>control</em> file) will be used in later steps. E.g. CDF name/revision and its
target product.</li>
<li>Download the system label manifest as XML.</li>
<li>Load the XML file. Some metadata about the system label will be used in
later steps. Mostly the list of included packages as the manifest will be
rewritten to fit the CDF.</li>
<li>Remove product packages from the manifest that are not referenced by the
CDF package (all but one).</li>
<li>Remove <tt class="docutils literal"><span class="pre">mw-system</span></tt> packages from the manifest that do not match the CDF
target product (all but one). The effect of this step is that C2D will
automatically figure out that just one target product is usable with the new
CDF label. That piece of information is critical to DUST when it tries to
pick suitable hardware to run tests on.</li>
<li>Remove the <tt class="docutils literal"><span class="pre">eng</span></tt> package from the manifest.</li>
<li>Add a reference to the CDF name and revision to the manifest. The name is
exactly the CDF Debian package name as found in metadata, above.</li>
<li>Check the new manifest for dependency problems, then write it to file.</li>
<li>Create a new label in C2D. The name is based on the CDF&#8217;s id and revision,
plus the system label. E.g <tt class="docutils literal"><span class="pre">cdf.1276.1247.R5C.sys.14.3.A.1.297</span></tt>. The name
is not important but gives a user some idea of what the label contains.</li>
<li>Upload the CDF Debian package to C2D. The package has not been modified in
any way. It is exactly as found in the original zip file.</li>
<li>Use the modified manifest XML file to promote packages to the new label. I.e.
the CDF package and all system label packages that were not pruned in the
previous steps (product and mw-system packages).</li>
<li>Wait for C2D to acknowledge the new label. (This is done by counting the
number of packages in the label and waiting until the score is what we
expect, given our local copy of the manifest.)</li>
<li>Change the status of the label to INTERNAL. This makes the label metadata
visible and closes the label so that it cannot be modified by regular users.</li>
<li>Print the name of the new label and exit.</li>
</ul>
<p>Notes:</p>
<ul class="simple">
<li>The name of the new label is not a traceability feature. The name can be
absolutely anything that was not already taken in C2D.</li>
<li>Traceability is supported by the label metadata that C2D keeps. The exact
names and revisions of all referenced packages, plus any additional metadata
we choose to set on the label.</li>
<li>The current implementation does not set any additional metadata because
DUST only needs the metadata generated by C2D. However, release managers may
want to add things. The function <tt class="docutils literal"><span class="pre">c2d.label.set_metadata(key,</span> <span class="pre">value)</span></tt> may
be used from <tt class="docutils literal"><span class="pre">bin/c2d-cdf-label</span></tt> to do this.</li>
<li>The metadata for the generated label still lists removed product packages
even though they are not referenced by the manifest. This is only at matter
of cleanliness and can be addressed later.</li>
</ul>
<div class="section" id="does-it-work">
<h3>Does it Work?<a class="headerlink" href="#does-it-work" title="Permalink to this headline">¶</a></h3>
<p>Try to make the composition with <tt class="docutils literal"><span class="pre">semcpkgtoimg</span></tt>. E.g:</p>
<div class="highlight-python"><pre>semcpkgtoimg \
     cdf-honami-1276-4318-customized-ce1-ce1 \
     variant-userdebug \
     result-flashable \
     --label=cdf.1276.4318.R3C.sys.14.3.A.1.295</pre>
</div>
<p>If this works, then DUST will be able to do the same and use the resulting
image in verification.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Verifying Customized Products</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#premises">Premises</a></li>
<li><a class="reference internal" href="#product-composition-label">Product Composition Label</a></li>
<li><a class="reference internal" href="#pcl-and-dust">PCL and DUST</a></li>
<li><a class="reference internal" href="#creation-of-pcls">Creation of PCLs</a><ul>
<li><a class="reference internal" href="#does-it-work">Does it Work?</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="code_coverage.html"
                        title="previous chapter">Create Code Coverage Report</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="schedulers.html"
                        title="next chapter">Scheduling</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/faq/customized_sw.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="schedulers.html" title="Scheduling"
             >next</a> |</li>
        <li class="right" >
          <a href="code_coverage.html" title="Create Code Coverage Report"
             >previous</a> |</li>
        <li><a href="../index.html">AVE User&#39;s Guide  documentation</a> &raquo;</li>
          <li><a href="index.html" >Frequently Asked Questions</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2014, Sony Mobile Communications Inc..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>